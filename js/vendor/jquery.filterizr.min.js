/**
* Filterizr is a jQuery plugin that sorts, shuffles and applies stunning filters over
* responsive galleries using CSS3 transitions and custom CSS effects.
*
* @author Yiotis Kaltsikis
* @see {@link http://yiotis.net/filterizr}
* @version 1.2.3
* @license MIT License
*/
!function(t,r){"use strict";if(!r)throw new Error("Filterizr requires jQuery to work.");var i=function(t){this.init(t)};i.prototype={init:function(t){this.root={x:0,y:0,w:t}},fit:function(t){var r,i,n,e=t.length,o=e>0?t[0].h:0;for(this.root.h=o,r=0;e>r;r++)n=t[r],(i=this.findNode(this.root,n.w,n.h))?n.fit=this.splitNode(i,n.w,n.h):n.fit=this.growDown(n.w,n.h)},findNode:function(t,r,i){return t.used?this.findNode(t.right,r,i)||this.findNode(t.down,r,i):r<=t.w&&i<=t.h?t:null},splitNode:function(t,r,i){return t.used=!0,t.down={x:t.x,y:t.y+i,w:t.w,h:t.h-i},t.right={x:t.x+r,y:t.y,w:t.w-r,h:i},t},growDown:function(t,r){var i;return this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+r,down:{x:0,y:this.root.h,w:this.root.w,h:r},right:this.root},(i=this.findNode(this.root,t,r))?this.splitNode(i,t,r):null}},r.fn.filterizr=function(){var t=this,i=arguments;if(t._fltr||(t._fltr=r.fn.filterizr.prototype.init(t.selector,"object"==typeof i[0]?i[0]:void 0)),"string"==typeof i[0]){if(i[0].lastIndexOf("_")>-1)throw new Error("Filterizr error: You cannot call private methods");if("function"!=typeof t._fltr[i[0]])throw new Error("Filterizr error: There is no such function");t._fltr[i[0]](i[1],i[2])}return t},r.fn.filterizr.prototype={init:function(t,i){var n=r(t).extend(r.fn.filterizr.prototype);return n.options={animationDuration:.5,callbacks:{onFilteringStart:function(){},onFilteringEnd:function(){},onShufflingStart:function(){},onShufflingEnd:function(){},onSortingStart:function(){},onSortingEnd:function(){}},delay:0,delayMode:"progressive",easing:"ease-out",filter:"all",filterOutCss:{opacity:0,transform:"scale(0.5)"},filterInCss:{opacity:1,transform:"scale(1)"},layout:"sameSize",selector:"string"==typeof t?t:".filtr-container",setupControls:!0,sortAttr:"domIndex",sortOrder:"asc"},0===arguments.length&&(t=n.options.selector,i=n.options),1===arguments.length&&"object"==typeof arguments[0]&&(i=arguments[0]),i&&n.setOptions(i),n.css({padding:0,position:"relative"}),n._lastCategory=0,n._isAnimating=!1,n._isShuffling=!1,n._isSorting=!1,n._mainArray=n._getFiltrItems(),n._subArrays=n._makeSubarrays(),n._activeArray=n._getCollectionByFilter(n.options.filter),n._toggledCategories={},n._typedText=r("input[data-search]").val()||"",n._uID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=16*Math.random()|0,i="x"==t?r:3&r|8;return i.toString(16)}),n._setupEvents(),n.options.setupControls&&n._setupControls(),n.filter(n.options.filter),n},filter:function(t){var r=this,i=r._multifilterModeOn()?r._makeMultifilterArray():r._getCollectionByFilter(t);r.options.filter=t,r.trigger("filteringStart"),r._handleFiltering(i),r._isSearchActivated()&&r.search(r._typedText)},toggleFilter:function(t){var r=this;t&&(r._toggledCategories[t]?delete r._toggledCategories[t]:r._toggledCategories[t]=!0),r._multifilterModeOn()?r.filter(r.options.filter):r.filter("all")},search:function(t){var r=this,i=r._multifilterModeOn()?r._makeMultifilterArray():r._getCollectionByFilter(r.options.filter),n=[],e=0;if(r._isSearchActivated())for(e=0;e<i.length;e++){var o=i[e].text().toLowerCase().indexOf(t.toLowerCase())>-1;o&&n.push(i[e])}if(n.length>0)r._handleFiltering(n);else if(r._isSearchActivated())for(e=0;e<r._activeArray.length;e++)r._activeArray[e]._filterOut();else r._handleFiltering(i)},shuffle:function(){var t=this;t._isAnimating=!0,t._isShuffling=!0,t.trigger("shufflingStart"),t._mainArray=t._fisherYatesShuffle(t._mainArray),t._subArrays=t._makeSubarrays();var r=t._multifilterModeOn()?t._makeMultifilterArray():t._getCollectionByFilter(t.options.filter);t._isSearchActivated()?t.search(t._typedText):t._placeItems(r)},sort:function(t,r){var i=this;i.options.sortAttr=t=t||"domIndex",i.options.sortOrder=r=r||"asc",i._isAnimating=!0,i._isSorting=!0,i.trigger("sortingStart");var n="domIndex"!==t&&"sortData"!==t&&"w"!==t&&"h"!==t;if(n)for(var e=0;e<i._mainArray.length;e++)i._mainArray[e][t]=i._mainArray[e].data(t);i._mainArray.sort(i._comparator(t,r)),i._subArrays=i._makeSubarrays();var o=i._multifilterModeOn()?i._makeMultifilterArray():i._getCollectionByFilter(i.options.filter);i._isSearchActivated()?i.search(i._typedText):i._placeItems(o)},appendToGallery:function(t,r){var i=this;return r=r||!1,Array.prototype.push.apply(i._mainArray,i._getFiltrItems(t)),i._subArrays=i._makeSubarrays(),i.append(t),i.filter(i.options.filter),r&&i.sort(i.options.sortAttr,i.options.sortOrder),i},setOptions:function(t){var r=this,i=0;for(var n in t)r.options[n]=t[n];if(r._mainArray&&(t.animationDuration||t.delay||t.easing||t.delayMode))for(i=0;i<r._mainArray.length;i++)r._mainArray[i].css("transition","all "+r.options.animationDuration+"s "+r.options.easing+" "+r._mainArray[i]._calcDelay()+"ms");t.callbacks&&(t.callbacks.onFilteringStart||(r.options.callbacks.onFilteringStart=function(){}),t.callbacks.onFilteringEnd||(r.options.callbacks.onFilteringEnd=function(){}),t.callbacks.onShufflingStart||(r.options.callbacks.onShufflingStart=function(){}),t.callbacks.onShufflingEnd||(r.options.callbacks.onShufflingEnd=function(){}),t.callbacks.onSortingStart||(r.options.callbacks.onSortingStart=function(){}),t.callbacks.onSortingEnd||(r.options.callbacks.onSortingEnd=function(){})),r.options.filterInCss.transform||(r.options.filterInCss.transform="translate3d(0,0,0)"),r.options.filterOutCss.transform||(r.options.filterOutCss.transform="translate3d(0,0,0)")},_getFiltrItems:function(t){var i=this,t=t||r(i.find(".filtr-item")),e=[],o=i._mainArray?i._mainArray.length:0;return r.each(t,function(t,a){var s=r(a).extend(n)._init(t+o,i);e.push(s)}),e},_makeSubarrays:function(){for(var t=this,r=[],i=0;i<t._mainArray.length;i++)if("object"==typeof t._mainArray[i]._category)for(var n=t._mainArray[i]._category.length,e=0;n>e;e++){var o=t._mainArray[i]._category[e];(r[o]=r[o]||[]).push(t._mainArray[i])}else{var o=t._mainArray[i]._category;(r[o]=r[o]||[]).push(t._mainArray[i])}return r},_makeMultifilterArray:function(){for(var t=this,r=[],i={},n=0;n<t._mainArray.length;n++){var e=t._mainArray[n],o=!1,a=e.domIndex in i==!1;if(Array.isArray(e._category)){for(var s=0;s<e._category.length;s++)if(e._category[s]in t._toggledCategories){o=!0;break}}else e._category in t._toggledCategories&&(o=!0);a&&o&&(i[e.domIndex]=!0,r.push(e))}return r},_setupControls:function(){var t=this;r("*[data-filter]").click(function(){var i=r(this).data("filter");t.options.filter!==i&&t.filter(i)}),r("*[data-multifilter]").click(function(){var i=r(this).data("multifilter");"all"===i?(t._toggledCategories={},t.filter("all")):t.toggleFilter(i)}),r("*[data-shuffle]").click(function(){t.shuffle()}),r("*[data-sortAsc]").click(function(){var i=r("*[data-sortOrder]").val();t.sort(i,"asc")}),r("*[data-sortDesc]").click(function(){var i=r("*[data-sortOrder]").val();t.sort(i,"desc")}),r("input[data-search]").keyup(function(){t._typedText=r(this).val(),t._delayEvent(function(){t.search(t._typedText)},250,t._uID)})},_setupEvents:function(){var i=this;r(t).resize(function(){i._delayEvent(function(){i.trigger("resizeFiltrContainer")},250,i._uID)}),i.on("resizeFiltrContainer",function(){i._multifilterModeOn()?i.toggleFilter():i.filter(i.options.filter)}).on("filteringStart",function(){i.options.callbacks.onFilteringStart()}).on("filteringEnd",function(){i.options.callbacks.onFilteringEnd()}).on("shufflingStart",function(){i._isShuffling=!0,i.options.callbacks.onShufflingStart()}).on("shufflingEnd",function(){i.options.callbacks.onShufflingEnd(),i._isShuffling=!1}).on("sortingStart",function(){i._isSorting=!0,i.options.callbacks.onSortingStart()}).on("sortingEnd",function(){i.options.callbacks.onSortingEnd(),i._isSorting=!1})},_calcItemPositions:function(){var t=this,n=t._activeArray,e=0,o=Math.round(t.width()/t.find(".filtr-item").outerWidth()),a=0,s=n[0].outerWidth(),l=0,f=0,u=0,c=0,g=0,_=[];if("packed"===t.options.layout){r.each(t._activeArray,function(t,r){r._updateDimensions()});var h=new i(t.outerWidth());for(h.fit(t._activeArray),c=0;c<n.length;c++)_.push({left:n[c].fit.x,top:n[c].fit.y});e=h.root.h}if("horizontal"===t.options.layout)for(a=1,c=1;c<=n.length;c++)s=n[c-1].outerWidth(),l=n[c-1].outerHeight(),_.push({left:f,top:u}),f+=s,l>e&&(e=l);else if("vertical"===t.options.layout){for(c=1;c<=n.length;c++)l=n[c-1].outerHeight(),_.push({left:f,top:u}),u+=l;e=u}else if("sameHeight"===t.options.layout){a=1;var d=t.outerWidth();for(c=1;c<=n.length;c++){s=n[c-1].width();var p=n[c-1].outerWidth(),y=0;n[c]&&(y=n[c].width()),_.push({left:f,top:u}),g=f+s+y,g>d?(g=0,f=0,u+=n[0].outerHeight(),a++):f+=p}e=a*n[0].outerHeight()}else if("sameWidth"===t.options.layout){for(c=1;c<=n.length;c++){if(_.push({left:f,top:u}),c%o===0&&a++,f+=s,u=0,a>0)for(g=a;g>0;)u+=n[c-o*g].outerHeight(),g--;c%o===0&&(f=0)}for(c=0;o>c;c++){for(var m=0,v=c;n[v];)m+=n[v].outerHeight(),v+=o;m>e?(e=m,m=0):m=0}}else if("sameSize"===t.options.layout){for(c=1;c<=n.length;c++)_.push({left:f,top:u}),f+=s,c%o===0&&(u+=n[0].outerHeight(),f=0);a=Math.ceil(n.length/o),e=a*n[0].outerHeight()}return t.css("height",e),_},_handleFiltering:function(t){for(var r=this,i=r._getArrayOfUniqueItems(r._activeArray,t),n=0;n<i.length;n++)i[n]._filterOut();r._activeArray=t,r._placeItems(t)},_multifilterModeOn:function(){var t=this;return Object.keys(t._toggledCategories).length>0},_isSearchActivated:function(){var t=this;return t._typedText.length>0},_placeItems:function(t){var r=this;r._isAnimating=!0,r._itemPositions=r._calcItemPositions();for(var i=0;i<t.length;i++)t[i]._filterIn(r._itemPositions[i])},_getCollectionByFilter:function(t){var r=this;return"all"===t?r._mainArray:r._subArrays[t]},_makeDeepCopy:function(t){var r={};for(var i in t)r[i]=t[i];return r},_comparator:function(t,r){return function(i,n){return"asc"===r?i[t]<n[t]?-1:i[t]>n[t]?1:0:"desc"===r?n[t]<i[t]?-1:n[t]>i[t]?1:0:void 0}},_getArrayOfUniqueItems:function(t,r){var i,n,e=[],o={},a=r.length;for(i=0;a>i;i++)o[r[i].domIndex]=!0;for(a=t.length,i=0;a>i;i++)n=t[i],n.domIndex in o||e.push(n);return e},_delayEvent:function(){var t={};return function(r,i,n){if(null===n)throw Error("UniqueID needed");t[n]&&clearTimeout(t[n]),t[n]=setTimeout(r,i)}}(),_fisherYatesShuffle:function(t){for(var r,i,n=t.length;n;)i=Math.floor(Math.random()*n--),r=t[n],t[n]=t[i],t[i]=r;return t}};var n={_init:function(t,r){var i=this;return i._parent=r,i._category=i._getCategory(),i._lastPos={},i.domIndex=t,i.sortData=i.data("sort"),i.w=0,i.h=0,i._isFilteredOut=!0,i._filteringOut=!1,i._filteringIn=!1,i.css(r.options.filterOutCss).css({"-webkit-backface-visibility":"hidden",perspective:"1000px","-webkit-perspective":"1000px","-webkit-transform-style":"preserve-3d",position:"absolute",transition:"all "+r.options.animationDuration+"s "+r.options.easing+" "+i._calcDelay()+"ms"}),i.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){i._onTransitionEnd()}),i},_updateDimensions:function(){var t=this;t.w=t.outerWidth(),t.h=t.outerHeight()},_calcDelay:function(){var t=this,r=0;return"progressive"===t._parent.options.delayMode?r=t._parent.options.delay*t.domIndex:t.domIndex%2===0&&(r=t._parent.options.delay),r},_getCategory:function(){var t=this,r=t.data("category");if("string"==typeof r){r=r.split(", ");for(var i=0;i<r.length;i++){if(isNaN(parseInt(r[i])))throw new Error("Filterizr: the value of data-category must be a number, starting from value 1 and increasing.");parseInt(r[i])>t._parent._lastCategory&&(t._parent._lastCategory=parseInt(r[i]))}}else r>t._parent._lastCategory&&(t._parent._lastCategory=r);return r},_onTransitionEnd:function(){var t=this;t._filteringOut?(r(t).addClass("filteredOut"),t._isFilteredOut=!0,t._filteringOut=!1):t._filteringIn&&(t._isFilteredOut=!1,t._filteringIn=!1),t._parent._isAnimating&&(t._parent._isShuffling?t._parent.trigger("shufflingEnd"):t._parent._isSorting?t._parent.trigger("sortingEnd"):t._parent.trigger("filteringEnd"),t._parent._isAnimating=!1)},_filterOut:function(){var t=this,r=t._parent._makeDeepCopy(t._parent.options.filterOutCss);r.transform+=" translate3d("+t._lastPos.left+"px,"+t._lastPos.top+"px, 0)",t.css(r),t.css("pointer-events","none"),t._filteringOut=!0},_filterIn:function(t){var i=this,n=i._parent._makeDeepCopy(i._parent.options.filterInCss);r(i).removeClass("filteredOut"),i._filteringIn=!0,i._lastPos=t,i.css("pointer-events","auto"),n.transform+=" translate3d("+t.left+"px,"+t.top+"px, 0)",i.css(n)}}}(this,jQuery);